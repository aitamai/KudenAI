# 05_フロントエンド概要（Vue）

> 現行フロントは Next.js(PWA) + React へ移行中だが、設計思想は Vue 時代のコンポーネント分割を踏襲しているため、本書では「Vue層」の観点で整理する。

## 技術スタック
- **Next.js 14 + React 18**（SSR/ISR・Edge 対応、旧 Vue SPA から移行）
- **TypeScript + Zustand/Redux Toolkit** で状態管理、OTP/プロフィール/会話状態を分離
- **next-intl** による i18n。UI と LLM プロンプトの言語切替を同期
- **WebRTC + MediaRecorder** で音声入力。Whisper API へ直接送信
- **PWA 対応**: iOS/Android Web install、Push/背景同期（App Store/Play 配信版と同一コードベース）

## 主要画面
1. **認証/登録 UI**
   - 2フェーズ（メール/パス→OTP）。OTP フォームは Redis の TTL に合わせてカウントダウン表示
   - パスワードリセットリンクをログイン画面下部に配置
   - 新規登録モーダルでプロフィール初期値（名前/職業/年齢/居住地）を入力
2. **チャット/日記 UI**
   - 「AI が質問 → ユーザー回答 → AI 要約/追記」フローを 1 画面内で表示
   - 会話ログを左、日記本文/要約を右に表示。音声入力ボタンと Whisper 文字起こし結果をインライン反映
   - 既存日記検索（RAG）を右パネルに表示、引用ハイライト付き
3. **マイページ/プロフィール**
   - 名前・アイコン・パスワード変更・職業・年齢・居住地・AI 公開フラグを編集
   - 機密項目入力欄の横にチェックボックスを配置し、暗号化対象を選択
   - 性格診断・文体チェックの進捗を % で表示、trait 推定結果をカード表示
4. **ダッシュボード**
   - 日記/AI/トークンの各カードからチャット UI を起動（どの段階からでも固定 URL を発行）
   - 利用量・ジョブ・RAG 状態・Langfuse 由来のトークン可視化グラフ
   - モバイル/デスクトップ共通レイアウト（レスポンシブグリッド）

## UX ポリシー
- **多段階入力の可視化**: プロフィールや AI 作成の入力率を円グラフ/バーで表示
- **アクセシビリティ**: 色覚対応テーマ、キーボード操作、ARIA 属性
- **オフライン/再開**: 日記バッファを IndexedDB に一時保存し、再接続時に再送
- **デバイス連携**: Web 版とスマホアプリ（ストア配信）で共通 UI。ディープリンクでチャットを直接起動

## エラーハンドリング
- OTP 失敗・トークン不足・RAG エラーをトースト + 詳細モーダルで表示
- セッション失効時は再ログインを促し、編集中データはローカル保存

